---
title: '**<br /> <br /> Opinión Pública en Uruguay **'
output:
  html_document:
    theme: flatly
    toc: yes
    toc_float: yes
    smooth_scroll: yes
    toc_depth: 2
    number_sections: false 
    css: "www/estilo.css"
  pdf_document:
    toc: yes
    toc_depth: '2'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```


```{r, echo=FALSE}
htmltools::img(src = knitr::image_uri("www/logo_umad.png"), 
               alt = 'logo', 
               style = 'position:absolute; top:0; right:0; padding:15px;max-width: 45%;')

library(tidyverse)
library(DT)
library(kableExtra)
library(downloadthis)
library(knitr)
library(opuy)
library(ggridges)
```

<br />
<br />

<div style="text-align: justify">
**La [Unidad de Métodos y Acceso a Datos](https://umad.cienciassociales.edu.uy/) (UMAD) (FCS-UdelaR) a partir del [Observatorio Uruguay](https://umad.cienciassociales.edu.uy/observatorio-uruguay/) busca aportar a la difusión de conocimiento respecto a temas de interés general sobre la realidad social, económica y política del Uruguay. Esta serie de documentos tiene como objetivo presentar indicadores clave para el análisis de tendencias históricas del país que esperamos sean de utilidad para las comunidades académicas, los tomadores de decisión y los formadores de opinión, así como el público en general. Se presentan aquí indicadores de opinión pública provenientes de encuestadoras locales y proyectos de opinión pública internacionales **
</div>

<br />

<hr style="border:1.5px solid #2c3e50"> </hr>

# **Opinión pública en Uruguay**

<div style="text-align: justify">

Las primeras encuestas de opinión pública en Uruguay de las que existe regristo datan alrededor de 1956 generando incluso una fuerte presencia en los diarios de la época hacia fines de la década del 1950 y 1960 (Aguiar, 2000). Incluso algunas de estas encuestas llevadas a cabo principalmente por la empresa Gallup están disponibles en el archivo de datos de ciencias sociales [**Roper Center**](https://ropercenter.cornell.edu/) de la Universidad de Cornell. Sin embargo, es a principio de los 90s que comienzan los estudios sistemáticos a nivel nacional de opinión pública -que cuentan con series históricas de preguntas realizadas hasta el día de hoy- en nuestro país (Zuasnábar, 2018). Hacia finales de la década de 1990 las consultoras [**Equipos**](https://equipos.com.uy/), [**Cifra**](https://www.cifra.com.uy/), [**Factum**](https://factum.uy/) e Interconsult y [**Radar**](https://www.gruporadar.com.uy/) a la que sumaría [**Opción Consultores**](https://www.opcion.com.uy/) en la década de 2010 realizan periódicamente encuestas de opinión pública para diversos actores en nuestro país, frecuentemente difundidas en medios de comunicación. 

A su vez, existen proyectos de opinión pública internacionales que realizan encuestas de opinión pública en Uruguay y habilitan acceso a los microdatos. Estos proyetos aplican los mismos -o muy similares- cuestionarios en distintos países de la región o el mundo facilitando los estudios comparados de opinión pública entre países. El proyecto de más larga data es [**Latinobarómetro**](https://www.latinobarometro.org/lat.jsp) que ha realizado 21 encuestas en nuestro país entre 1995 y 2020, realizando también encuestas en otros 17 países latinoamericanos y España. A su vez, el [**Barómetro de las Américas**](https://www.vanderbilt.edu/lapop-espanol/acerca-americasbarometer.php) de [**LAPOP**](https://www.vanderbilt.edu/lapop-espanol/) de la Universidad de Vanderbilt realiza encuestas periódicamente desde 2006 en nuestro país y otros países de la región y fuera de la región también. A su vez, otros proyectos internacionales que ocasionalmente realizan encuestas de opinión pública en Uruguay son la [**Encuesta Mundial de Valores**](https://www.worldvaluessurvey.org/WVSNewsShow.jsp?ID=249) (1996, 2006 y 2011) y el [**Comparative Study of Electoral Systems**](https://cses.org/) (2009 y 2019)
</div>

## **Guía de uso**

Hablar de margen de error, diferentes question wordings, etc.

<br />

<hr style="border:1.5px solid #2c3e50"> </hr>

# **Evaluación presidencial**

<div style="text-align: justify">
**La evaluación presidencial** es uno de los indicadores más utilizados en el estudio de la opinión pública en sistemas presidencialistas y releva cómo la opinión pública evalúa la gestión del presidente. Entre otros motivos, la aprobación presidencial es importante en sistemas presidencialistas porque los presidentes pueden utilizar las evaluaciones que la opinión pública como una guía para ajustar sus programas (Carlin et al., 2015). De esta forma, la aprobación presidencial funciona como un mecanismo de *accountability* o rendición de cuentas que el electorado posee para reaccionar frente a las decisiones del presidente. Entre otras consecuencias, existe evidencia para América Latina de que una eleveda aprobación presidencial aumenta la probabilidad de pasar legistlatura de forma satisfactoria (Calvo, 2007), contribuye a gobiernos más estables (Martinez-Gallardo, 2012) y aumenta la probabilidad de los presidentes de terminar sus mandatos (Perez-Liñán, 2007).
</div>

<br>

<div class="boxed">
**La evaluación del presidente en Uruguay se releva releva a nivel nacional de forma ininterrumpida fines de la década de 1980 por consultoras de opinión pública locales. El fraseo de la pregunta suele ser alguna variación de** *"¿Ud. aprueba o desaprueba la forma en que se está desempeñando el Presidente?"*.  
</div>

<br />

## **Ciclos de aprobación presidencial**

```{r , echo=FALSE, out.width= "55%", out.extra='style="float:right; padding:5px"'}
include_graphics("www/ciclos.png")
```

<div style="text-align: justify">
La aprobación presidencial suele -aunque no siempre- mostrar un **patrón cíclico** con forma de tick invertido, divido en tres etapas (Stimson, 1976; Carlin et al., 2018): 
<ol>
  <li>**Luna de miel**: los primeros meses de mandato suele ser el período donde el presidente obtiene mayor aprobación </li>
  <li>**Deterioro**: posterior a la luna de miel, usualmente antes de cumplido el primer año del mandato, suele existir un declive gradual de la aprobación hasta cerca del año antes del término de su mandato. </li>
  <li>**Recupero final**: en los últimos meses del mandato y previo a la próxima elección, la aprobación del presidente suele recuperarse, aunque sin alcanzar los niveles de la luna de miel. Uruguay es el país en América Latina que suele tener los repuntes más altos (Carlin et al., 2018) </li>
</ol>
</div>

<br />

## **Serie histórica de aprobación**

<div style="text-align: justify">
Como se menciona en la guía de uso, es necesario tener ciertos recabos al agregar datos de diferentes encuestas. Las consultoras de opinión pública que publican datos de evaluación del presidente suelen diferir en el fraseo de la pregunta, método de administración o esquema de ponderación. De esta forma, es necesario ser cauteloso al interpretar diferencias entre dos encuestas realizadas de forma distinta, dado que el error no muestral puede causar diferencias mayores al margen de error teórico. 

Para poder analizar el cambio en el tiempo de la evaluación del presidente presentamos los datos de tres maneras, para que el usuario pueda utilizar la que más se ajuste a sus necesidades (se puede acceder a los datos completos a través del paquete de R [**opuy**](https://github.com/Nicolas-Schmidt/opuy)): **(1)** calculamos la tendencia utilizando todos los datos disponibles en [**opuy**](https://github.com/Nicolas-Schmidt/opuy) mediante una regresión local (loess); **(2)** combinamos los datos de las series de cada encuestadora utilizando el algoritmo de *dyads-ratio* para estimar una sola serie; **(3)** presentamos la serie con los datos de la consultora con mayor cantidad de encuestas -en este caso Equipos-. Cada estrategia de análisis tiene ventajas y desventajas que deben ser consideradas al emplear estos datos una investigación. 
</div>

<br />

### **1. Datos crudos de todas las fuentes**

<div style="text-align: justify">
Los datos de evaluación del presidente disponibles en [**opuy**](https://github.com/Nicolas-Schmidt/opuy) conforman distintas series que no son estrictamente comparables, es decir, la serie de una consultora puede presentar de forma sistemática evaluaciones superiores o inferiores a la de otra consultora debido a los métodos utilizados (método de administración, pregunta, categorías de respuesta, esquema de ponderación, etc.). Por esto desaconsejamos el uso lineal de los datos combinados, y simplemente presentamos una línea de tendencia -estimada con una regresión local- que permite estimar a grandes rasgos los niveles absolutos de evaluación en cada período y la variación en cada período.

Los gráficos debajo muestran datos para 7 períodos presidenciales aunque solo existe información para todo el perído entre el segundo gobierno de Sanguinetti y el segundo gobierno de Vázquez. 4 de las 5 administraciones para las que tenemos datos del período completo se ajustan al ciclo típico de aprobación presidencial: luna de miel, declive y repunte final, con la excepción del segundo gobierno de Sanguinetti, que muestra un repunte final pero no una luna de miel. 
</div>

### {.tabset .tabset-fade .tabset-pills}

#### **Gráfico (% aprobación)**

```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Descargar y manipular data desde opuy
dat_opuy <- opuy %>%
  filter(medicion == 'Evaluacion de gestion presidente',
         categoria_unificada == 3) %>%
  select(fecha, empresa, valor, presidente) %>%
  mutate(presidente = factor(presidente, 
                             levels = c("Lacalle", "Sanguinetti 2", "Batlle",
                                        "Vazquez 1", "Mujica", "Vazquez 2",
                                        "Lacalle Pou"))) 

# Anotaciones
annotation <- data.frame(
  x = as.Date(c( "1992-01-01","1997-06-06", "2002-06-06", "2007-06-06", 
                 "2012-06-06", "2017-06-06", "2022-01-01")),
  y = 85,
  label = c("Lacalle","Sanguinetti II", "Batlle", "Vázquez I", "Mujica",
            "Vázquez II", "Lacalle Pou"))

fechas <- as.Date(c("1995-01-01","2000-01-01", "2005-01-01",
                    "2010-01-01", "2015-01-01", "2020-01-01"))


# Grafico
aprob_serie <- dat_opuy %>%
  ggplot(aes(x = fecha, y = valor, color = presidente)) +
  geom_smooth(aes(group = presidente), method ="loess", se = FALSE) +
  geom_point(size = 1.5, alpha = 0.3) +
  geom_vline(xintercept = as.numeric(fechas),
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "% de aprobación",
       x = "",
       title = "Serie histórica de aprobación del presidente",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy 
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar') +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) +
  scale_x_date(date_breaks = "2 years", date_minor_breaks = "1 year",
               date_labels = "%Y", limits = c(as.Date("1990-01-01"), NA))   

plot(aprob_serie)
```

```{r}
download_this(aprob_serie,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```

#### **Gráfico (saldo neto)**

```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Descargar y manipular data desde opuy
dat_opuy <- opuy %>%
  filter(medicion == 'Evaluacion de gestion presidente') %>%
  select(fecha, anio_gobierno, empresa, valor, presidente, categoria_unificada)  %>%
  mutate(categoria_unificada = case_when(
    categoria_unificada == 3 ~ "Aprueba",  
    categoria_unificada == 2 ~ "Ni aprueba ni desaprueba",
    categoria_unificada == 1 ~ "Desaprueba",
    categoria_unificada == 0 ~ "NSNC")) %>%
  pivot_wider(names_from = categoria_unificada, values_from = valor) %>% 
  mutate(Saldo = Aprueba - Desaprueba) %>% 
  mutate(presidente = factor(presidente, 
                             levels = c("Lacalle", "Sanguinetti 2", "Batlle",
                                        "Vazquez 1", "Mujica", "Vazquez 2",
                                        "Lacalle Pou")))
# Anotaciones
annotation <- data.frame(
  x = as.Date(c( "1992-01-01","1997-06-06", "2002-06-06", "2007-06-06", 
                 "2012-06-06", "2017-06-06", "2022-01-01")),
  y = 85,
  label = c("Lacalle","Sanguinetti II", "Batlle", "Vázquez I", "Mujica",
            "Vázquez II", "Lacalle Pou"))

fechas <- as.Date(c("1995-01-01","2000-01-01", "2005-01-01",
                    "2010-01-01", "2015-01-01", "2020-01-01"))


# Grafico
aprob_serie_s <- dat_opuy %>%
  ggplot(aes(x = fecha, y = Saldo, color = presidente)) +
  geom_smooth(aes(group = presidente), method ="loess", se = FALSE) +
  geom_point(size = 1.5, alpha = 0.3) +
  geom_vline(xintercept = as.numeric(fechas),
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_hline(yintercept = 0, size = 0.3) +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  annotate("segment", x = as.Date("1990-01-01"), y = 10, xend = as.Date("1990-01-01"), yend = 25,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n positivas",
           x = as.Date("1992-06-01"), 
           y = 15,
           size = 3) +
  annotate("segment", x = as.Date("1990-01-01"), y = -10, xend = as.Date("1990-01-01"), yend = -25,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n negativas",
           x = as.Date("1992-06-01"), 
           y = -15,
           size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "Saldo neto",
       x = "",
       title = "Serie histórica de evaluación del presidente",
       subtitle = "Saldo neto = (% aprobación - % desaprobación)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar') +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) +
  scale_x_date(date_breaks = "2 years", date_minor_breaks = "1 year",
               date_labels = "%Y", limits = c(as.Date("1990-01-01"), NA))   

plot(aprob_serie_s)
```

```{r}
download_this(aprob_serie_s,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Tabla**

```{r}
DT::datatable(dat_opuy %>%
                select(-anio_gobierno) %>% 
                arrange(desc(fecha)),
              extensions =  'Buttons',
              options =  list(dom = 'Bfrtip',
                              buttons = c('copy', 'csv', 'excel', 'print')))
```

#### **Código en R**

```{r, echo=TRUE, eval=FALSE}
## Instalar en caso de ser necesario
# install.packages("tidyverse")
# remotes::install_github("Nicolas-Schmidt/opuy")

library(opuy)
library(tidyverse)

# Descargar data desde opuy y crear tabla
dat_opuy <- opuy %>%
  filter(medicion == 'Evaluacion de gestion presidente') %>%
  select(fecha, anio_gobierno, empresa, valor, presidente, categoria_unificada)  %>%
  mutate(categoria_unificada = case_when(
    categoria_unificada == 3 ~ "Aprueba",  
    categoria_unificada == 2 ~ "Ni aprueba ni desaprueba",
    categoria_unificada == 1 ~ "Desaprueba",
    categoria_unificada == 0 ~ "NSNC")) %>%
  pivot_wider(names_from = categoria_unificada, values_from = valor) %>% 
  mutate(Saldo = Aprueba - Desaprueba) %>% 
  mutate(presidente = factor(presidente, 
                             levels = c("Lacalle", "Sanguinetti 2", "Batlle",
                                        "Vazquez 1", "Mujica", "Vazquez 2",
                                        "Lacalle Pou")))

# Anotaciones para gráfico
annotation <- data.frame(
  x = as.Date(c( "1992-01-01","1997-06-06", "2002-06-06", "2007-06-06", 
                 "2012-06-06", "2017-06-06", "2022-01-01")),
  y = 85,
  label = c("Lacalle","Sanguinetti II", "Batlle", "Vázquez I", "Mujica",
            "Vázquez II", "Lacalle Pou"))

fechas <- as.Date(c("1995-01-01","2000-01-01", "2005-01-01",
                    "2010-01-01", "2015-01-01", "2020-01-01"))


# Grafico % aprobación
aprob_serie <- dat_opuy %>%
  ggplot(aes(x = fecha, y = Aprueba, color = presidente)) +
  geom_smooth(aes(group = presidente), method ="loess", se = FALSE) +
  geom_point(size = 1.5, alpha = 0.3) +
  geom_vline(xintercept = as.numeric(fechas),
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3, fontface = "bold") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "% de aprobación",
       x = "",
       title = "Serie histórica de aprobación del presidente",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy \n 
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar') +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) +
  scale_x_date(date_breaks = "2 years", date_minor_breaks = "1 year",
               date_labels = "%Y", limits = c(as.Date("1990-01-01"), NA))   

plot(aprob_serie)

# Grafico saldo neto
aprob_serie_s <- dat_opuy %>%
  ggplot(aes(x = fecha, y = Saldo, color = presidente)) +
  geom_smooth(aes(group = presidente), method ="loess", se = FALSE) +
  geom_point(size = 1.5, alpha = 0.3) +
  geom_vline(xintercept = as.numeric(fechas),
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_hline(yintercept = 0, size = 0.3) +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  annotate("segment", x = as.Date("1990-01-01"), y = 10, xend = as.Date("1990-01-01"), yend = 25,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n positivas",
           x = as.Date("1992-06-01"), 
           y = 15,
           size = 3) +
  annotate("segment", x = as.Date("1990-01-01"), y = -10, xend = as.Date("1990-01-01"), yend = -25,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n negativas",
           x = as.Date("1992-06-01"), 
           y = -15,
           size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none",
        title = element_text(face = "bold")) +
  labs(y = "Saldo neto",
       x = "",
       title = "Serie histórica de evaluación del presidente",
       subtitle = "Saldo neto = (% aprobación - % desaprobación)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy \n 
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar') +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) +
  scale_x_date(date_breaks = "2 years", date_minor_breaks = "1 year",
               date_labels = "%Y", limits = c(as.Date("1990-01-01"), NA))   

plot(aprob_serie_s)
```


## {.toc-ignore .unlisted .unnumbered}

<div style="text-align: justify">
Por otra parte, los gráficos debajo resume mediante diagramas de caja (aunque manteniendo el valor de cada encuesta, con error aleatorio en el eje horizontal para mejorar la visualización) la distribución tanto del % de aprobación como del saldo neto, para los gobiernos donde tenemos datos para la totalidad del período. El primer gobierno de Vázquez junto al gobierno de Mujica son los gobiernos con mayor aprobación presidencial. El gobierno de Batlle es el que presenta mayor variación, con niveles de aprobación cercanos al 50% al comienzo pero alvanzando los niveles más bajos de los que hay registro, cercanos al 10% de aprobación.
</div>

### {.tabset .tabset-fade .tabset-pills}

#### **Gráfico (% aprobación)**

```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Descargar y manipular data desde opuy
dat_opuy <- opuy %>%
  filter(medicion == 'Evaluacion de gestion presidente') %>%
  select(fecha, anio_gobierno, empresa, valor, presidente, categoria_unificada)  %>%
  mutate(categoria_unificada = case_when(
    categoria_unificada == 3 ~ "Aprueba",  
    categoria_unificada == 2 ~ "Ni aprueba ni desaprueba",
    categoria_unificada == 1 ~ "Desaprueba",
    categoria_unificada == 0 ~ "NSNC")) %>%
  pivot_wider(names_from = categoria_unificada, values_from = valor) %>% 
  mutate(Saldo = Aprueba - Desaprueba) %>% 
  mutate(presidente = factor(presidente, 
                             levels = c("Lacalle", "Sanguinetti 2", "Batlle",
                                        "Vazquez 1", "Mujica", "Vazquez 2",
                                        "Lacalle Pou")))

# Boxplot aprobación
promedio_aprob <- ggplot(dat_opuy %>% 
         filter(presidente != "Lacalle Pou"),
       aes(x = presidente, y = Aprueba)) +
  geom_boxplot(aes(fill = presidente), outlier.shape = NA, lwd = 1, alpha = 0.4) +
  geom_jitter(aes(color = presidente), size = 2, alpha = 0.5) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Evaluación del presidente",
       subtitle = "Diagrama de caja, % de aprobación",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar',
       y = "% de Aprobación",
       x = "") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) +
  scale_fill_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2"))
plot(promedio_aprob)

```

```{r}
download_this(promedio_aprob,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```

#### **Gráfico (saldo neto)**

```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Boxplot saldo neto
promedio_saldo <- ggplot(dat_opuy %>% 
         filter(presidente != "Lacalle Pou"),
       aes(x = presidente, y = Saldo)) +
  geom_boxplot(aes(fill = presidente), outlier.shape = NA, lwd = 1, alpha = 0.4) +
  geom_jitter(aes(color = presidente), size = 2, alpha = 0.5) +
  geom_hline(yintercept = 0, size = .3, linetype = "dashed") +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Evaluación del presidente",
       subtitle = "Diagrama de caja, saldo neto",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy 
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar',
       y = "% de Aprobación",
       x = "") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) +
  scale_fill_manual(name = "",
                    values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                               "#013197", "#013197", "#5DADE2"))

plot(promedio_saldo)
```

```{r}
download_this(aprob_serie_s,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Tabla**

```{r}
DT::datatable(dat_opuy %>%
                select(-anio_gobierno) %>% 
                arrange(desc(fecha)),
              extensions =  'Buttons',
              options =  list(dom = 'Bfrtip',
                              buttons = c('copy', 'csv', 'excel', 'print')))
```

#### **Código en R**

```{r, echo=TRUE, eval=FALSE}
## Instalar en caso de ser necesario
# install.packages("tidyverse")
# remotes::install_github("Nicolas-Schmidt/opuy")

library(opuy)
library(tidyverse)

# Descargar y manipular data desde opuy
dat_opuy <- opuy %>%
  filter(medicion == 'Evaluacion de gestion presidente') %>%
  select(fecha, anio_gobierno, empresa, valor, presidente, categoria_unificada)  %>%
  mutate(categoria_unificada = case_when(
    categoria_unificada == 3 ~ "Aprueba",  
    categoria_unificada == 2 ~ "Ni aprueba ni desaprueba",
    categoria_unificada == 1 ~ "Desaprueba",
    categoria_unificada == 0 ~ "NSNC")) %>%
  pivot_wider(names_from = categoria_unificada, values_from = valor) %>% 
  mutate(Saldo = Aprueba - Desaprueba) %>% 
  mutate(presidente = factor(presidente, 
                             levels = c("Lacalle", "Sanguinetti 2", "Batlle",
                                        "Vazquez 1", "Mujica", "Vazquez 2",
                                        "Lacalle Pou")))

# Distribución aprobación
ggplot(dat_opuy %>% 
         filter(presidente != "Lacalle Pou"),
       aes(x = presidente, y = Aprueba)) +
  geom_boxplot(aes(fill = presidente), outlier.shape = NA, lwd = 1, alpha = 0.4) +
  geom_jitter(aes(color = presidente), size = 2, alpha = 0.5) +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(title = "Evaluación del presidente",
       subtitle = "Diagrama de caja, % de aprobación",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar',
       y = "% de Aprobación",
       x = "") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) +
  scale_fill_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2"))
```



## {.toc-ignore .unlisted .unnumbered}

### **2. Estimación mediante algoritmo de *dyad-ratios* **

Para obtener una estimación concreta que permita maximizar los datos de todas las fuentes sin comparar linealmente series de distintas consultoras, estimamos una dimensión latente de aprobación presidencial con el algoritmo de *dyad-ratios* siguiendo el enfoque del [Executive Approval Project](http://www.executiveapproval.org/datasets) (ver Carlin et al., 2015). El algoritmo de dyad-ratios fue creado por James Stimson en 1991 y es parte fundamental del estudio temporal de la opinión pública agregada. El algoritmo funciona bajo el supuesto de que la proporción entre dos valores cualquiera dentro de una serie -en este caso series de evaluación del presidente de distintas consultoras, con sus diferencias metodológicas- son indicadores válidos de del cambio relativo en la dimensión latente. Si estos cambios relativos verdaderamente reflejan a una dimensión latente común, deberían variar en conjunto -por más detalles sobre el funcionamiento del algoritmo ver (Stimson, 2018)-. 

Los gráficos debajo musetran la estimación de la evaluación presidencial (tanto en % de aprobación como en saldo neto) para cada trimestre desde 1990 a 2021. La estimación explica el 90%de la varianza, al mismo tiempo que todas las series correlacionan de forma positiva con la estimación. La principal ventaja de este método nos permite obtener una estimación concreta para cada trimestre, maximizando la información de todas las fuentes. En términos generales la estimación trimestral también permite ver los patrones cíclicos de la evaluación presidencial, aunque evidenciando ciertas oscilaciones a mitad de mandato, por ejemplo Mujica alcanza su menor nivel de aprobación en el segundo trimestre del segundo año, Jorge Batlle durante la mitad del período (primer trimestre de 2003) mientras que el segundo gobierno de Vázquez obtiene su menor nivel de aprobación en el primer trimestre de su último año demandato.


### {.tabset .tabset-fade .tabset-pills}

#### **Gráfico (% aprobación)**
```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
serie_dr <- readxl::read_excel("data/aprob-dyad-ratio/serie_dyad_ratios.xlsx") %>% 
    mutate(quarter = zoo::as.yearqtr(format(quarter), "%Y Q%q"))

# Anotaciones para gráfico
annotation <- data.frame(
  x = fechas <- c(1992.25, 1997.25, 2002.25, 2007.25, 2012.25, 2017.25, 2022.25),
  y = 85,
  label = c("Lacalle","Sanguinetti II", "Batlle", "Vázquez I", "Mujica",
            "Vázquez II", "Lacalle Pou"))

fechas <- c(1994.85, 1999.85, 2004.85, 2009.85, 2014.85, 2019.85)

# Grafico % aprobación
plot_dr <- serie_dr %>%
  ggplot(aes(x = quarter, y = aprobacion, color = aprobacion)) +
  geom_line(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  geom_vline(xintercept = fechas,
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "% de aprobación",
       x = "",
       title = "Serie histórica de aprobación del presidente",
       subtitle = "Cálculos sobre datos estimados mediante el algoritmo de dyads-ratio (% de aprobación)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar') +
  scale_colour_gradient2(low = "firebrick2", mid = "gold2" , high = "forestgreen", 
                         midpoint = mean(serie_dr$aprobacion)) 

plot(plot_dr)
```

```{r}
download_this(plot_dr,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Gráfico (saldo neto)**

```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Grafico % aprobación
plot_dr_s <- serie_dr %>%
  ggplot(aes(x = quarter, y = saldo, color = saldo)) +
  geom_line(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = fechas,
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_hline(yintercept = 0, size = 0.3) +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  annotate("segment", x = 1990.00, y = 30, xend = 1990.00, yend = 45,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n positivas",
           x = 1992.05, 
           y = 35,
           size = 3) +
  annotate("segment", x = 1990.00, y = -30, xend = 1990.00, yend = -45,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n negativas",
           x = 1992.05, 
           y = -35,
           size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "saldo neto",
       x = "",
       title = "Serie histórica de evaluación del presidente",
       subtitle = "Estimación utilizando el algoritmo de dyads-ratio (saldo neto)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar') +
  scale_colour_gradient2(low = "firebrick2", mid = "gold2" , high = "forestgreen", 
                         midpoint = mean(serie_dr$saldo)) +
  ylim(-50, 90)

plot(plot_dr_s)

```

```{r}
download_this(plot_dr_s,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Tabla** 

```{r}
serie_dr <- readxl::read_excel("data/aprob-dyad-ratio/serie_dyad_ratios.xlsx")

DT::datatable(serie_dr %>%
                rename(trimestre = quarter) %>% 
                arrange(desc(trimestre)),
              extensions =  'Buttons',
              options =  list(dom = 'Bfrtip',
                              buttons = c('copy', 'csv', 'excel', 'print')))
```


#### **Código en R**

```{r, echo=TRUE, eval=FALSE}
## Instalar en caso de ser necesario
# install.packages("tidyverse")
# install.packages("zoo")
# remotes::install_github("Nicolas-Schmidt/opuy")

library(opuy)
library(tidyverse)

# Cargo la tabla (descargar de pestaña tabla)
serie_dr <- readxl::read_excel("data/aprob-dyad-ratio/serie_dyad_ratios.xlsx") %>% 
  mutate(quarter = zoo::as.yearqtr(format(quarter), "%Y Q%q"))

# Anotaciones para gráfico
annotation <- data.frame(
  x = fechas <- c(1992.25, 1997.25, 2002.25, 2007.25, 2012.25, 2017.25, 2022.25),
  y = 85,
  label = c("Lacalle","Sanguinetti II", "Batlle", "Vázquez I", "Mujica",
            "Vázquez II", "Lacalle Pou"))

fechas <- c(1994.85, 1999.85, 2004.85, 2009.85, 2014.85, 2019.85)

# Grafico % aprobación
plot_dr_a <- serie_dr %>%
  ggplot(aes(x = quarter, y = aprobacion, color = aprobacion)) +
  geom_line(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  geom_vline(xintercept = fechas,
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "% de aprobación",
       x = "",
       title = "Serie histórica de aprobación del presidente",
       subtitle = "Estimación utilizando el algoritmo de dyads-ratio",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar') +
  scale_colour_gradient2(low = "firebrick2", mid = "gold2" , high = "forestgreen", 
                         midpoint = mean(serie_dr$aprobacion)) 

plot(plot_dr_a)

## Serie de saldo neto dyad-ratios 

# Grafico % aprobación
plot_dr_s <- serie_dr %>%
  ggplot(aes(x = quarter, y = saldo, color = saldo)) +
  geom_line(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = fechas,
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_hline(yintercept = 0, size = 0.3) +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  annotate("segment", x = 1990.00, y = 30, xend = 1990.00, yend = 45,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n positivas",
           x = 1992.05, 
           y = 35,
           size = 3) +
  annotate("segment", x = 1990.00, y = -30, xend = 1990.00, yend = -45,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n negativas",
           x = 1992.05, 
           y = -35,
           size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "saldo neto",
       x = "",
       title = "Serie histórica de evaluación del presidente",
       subtitle = "Cálculos sobre datos estimados mediante el algoritmo de dyads-ratio (% de aprobación)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar') +
  scale_colour_gradient2(low = "firebrick2", mid = "gold2" , high = "forestgreen", 
                         midpoint = mean(serie_dr$saldo)) +
  ylim(-50, 90)

plot(plot_dr_s)

```



## {.toc-ignore .unlisted .unnumbered}

Los gráficos debajo muestran la media de nuestra estimación trimestral para % de aprobación y saldo neto, con las barras de error representando la desviación estandar. Las medias de la aprobación trimestral presentan un escenario similar al descripto anteriormente, con el primer gobierno de Vázquez y el gobierno de Mujica como los de mayor aprobación, y un nivel simiilar para el segundo gobierno de Sanguinetti y Vázquez. A su vez, la administración de Batlle es la que presenta mayor desviación debido a su luna de miel con altos % de aprobación y su posterior marcado declive hasta posiciones mayoritariamente negativas.


### {.tabset .tabset-fade .tabset-pills}

#### **Gráfico (% aprobación)**
```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Cargo la tabla
serie_dr <- readxl::read_excel("data/aprob-dyad-ratio/serie_dyad_ratios.xlsx") %>% 
  mutate(quarter = zoo::as.yearqtr(format(quarter), "%Y Q%q"))

dat_promedio <- serie_dr %>% 
  mutate(presidencia = factor(presidencia, levels = c("Lacalle", "Sanguinetti II", 
                                                      "Batlle", "Vázquez I", "Mujica", 
                                                      "Vázquez II", "Lacalle Pou"))) %>%
  group_by(presidencia) %>% 
  filter(presidencia != "Lacalle Pou") %>% # Solo mandatos terminados
  summarize(aprob_m = round(mean(aprobacion), digits = 1),
            aprob_sd = round(sd(aprobacion), digits = 1),
            saldo_m = round(mean(saldo), digits = 1),
            saldo_sd = round(sd(saldo), digits = 1)) 


plot_promedio <- ggplot(data = dat_promedio,
       aes(x = presidencia, y = aprob_m, color = presidencia)) +
  geom_errorbar(aes(ymin = aprob_m - aprob_sd, ymax = aprob_m + aprob_sd), width=.1) +
  geom_point(size=3) +
  geom_text(aes(label = aprob_m),hjust = -.5, vjust = .5) +
  labs(title = "Promedio y desvío estandar de aprobación del presidente según administración",
       subtitle = "Estimación utilizando el algoritmo de dyads-ratio (% de aprobación)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar',
       x = "",
       y = "") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) 

plot(plot_promedio)
```

```{r}
download_this(plot_promedio,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Gráfico (saldo neto)**
```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Saldo neto
plot_promedio_s <- ggplot(data = dat_promedio,
                          aes(x = presidencia, y = saldo_m, color = presidencia)) +
  geom_errorbar(aes(ymin = saldo_m - saldo_sd, ymax = saldo_m + saldo_sd), width=.1) +
  geom_point(size=3) +
  geom_text(aes(label = saldo_m),hjust = -.5, vjust = .5) +
  geom_hline(yintercept = 0, size = .3, linetype = "dashed") +
  labs(title = "Promedio y desvío estandar de evaluación del presidente según administración",
       subtitle = "Cálculos sobre datos estimados mediante el algoritmo de dyads-ratio (saldo neto)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar',
       y = "", x = "") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) 

plot(plot_promedio_s)
```

```{r}
download_this(plot_promedio_s,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Tabla**

```{r}
DT::datatable(dat_promedio %>% 
                rename(Aprobación_Media = aprob_m,
                       Aprobación_Desvío = aprob_sd,
                       Saldo_Media = saldo_m,
                       Saldo_Desvío = saldo_sd,
                       Presidente = presidencia),
              extensions =  'Buttons',
              options =  list(dom = 'Bfrtip',
                              buttons = c('copy', 'csv', 'excel', 'print')))
```


#### **Código en R**

```{r, echo=TRUE, eval=FALSE}
## Instalar en caso de ser necesario
# install.packages("tidyverse")
# install.packages("zoo")
# remotes::install_github("Nicolas-Schmidt/opuy")

library(opuy)
library(tidyverse)

# Cargo la tabla
serie_dr <- readxl::read_excel("data/aprob-dyad-ratio/serie_dyad_ratios.xlsx") %>% 
  mutate(quarter = zoo::as.yearqtr(format(quarter), "%Y Q%q"))

dat_promedio <- serie_dr %>% 
  mutate(presidencia = factor(presidencia, levels = c("Lacalle", "Sanguinetti II", 
                                                      "Batlle", "Vázquez I", "Mujica", 
                                                      "Vázquez II", "Lacalle Pou"))) %>%
  group_by(presidencia) %>% 
  filter(presidencia != "Lacalle Pou") %>% # Solo mandatos terminados
  summarize(aprob_m = round(mean(aprobacion), digits = 1),
            aprob_sd = round(sd(aprobacion), digits = 1)) 

# Gráfico Aprobación
plot_promedio <- ggplot(data = dat_promedio,
       aes(x = presidencia, y = aprob_m, color = presidencia)) +
  geom_errorbar(aes(ymin = aprob_m - aprob_sd, ymax = aprob_m + aprob_sd), width=.1) +
  geom_point(size=3) +
  geom_text(aes(label = aprob_m),hjust = -.5, vjust = .5) +
  labs(title = "Promedio y desvío estandar de aprobación del presidente según administración",
       subtitle = "Cálculos sobre datos estimados mediante el algoritmo de dyads-ratio (% de aprobación)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar',
       x = "",
       y = "") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) 

plot(plot_promedio)


# Saldo neto
plot_promedio_s <- ggplot(data = dat_equipos_avg,
                          aes(x = presidente, y = saldo_m, color = presidente)) +
  geom_errorbar(aes(ymin = saldo_m - saldo_sd, ymax = saldo_m + saldo_sd), width=.1) +
  geom_point(size=3) +
  geom_hline(yintercept = 0, size = .3, linetype = "dashed") +
  geom_text(aes(label = saldo_m),hjust = -.5, vjust = .5) +
  labs(title = "Promedio y desvío estandar de evaluación del presidente según administración",
       subtitle = "Cálculos sobre datos estimados mediante el algoritmo de dyads-ratio (saldo neto)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy  
       Datos originales de Equipos, Cifra, Factum, Opción, Interconsult y Radar',
       y = "", x = "") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) 

plot(plot_promedio_s)
```

### **3. Datos solo de Equipos Consultores **

Por último, también es posible analizar la serie utilizando los datos de una única consultora, para mantener lo más constante posible la metodología de las encuestas. Si bien pueden existir cambios en la serie de una misma consultora, normalmente los grandes aspectos metodológicos presentan pocos cambios permitiendo la comparación lineal. En este caso presentamos la serie de Equipos Consultores porque es la mayor dentro de los datos de opuy (64% de las encuestas disponibles fueron realizadas por Equipos). Al igual que con la estimación mediante el algortimo de *dyad-ratios* la serie es trimestral. Como es de esperarse, los resultados son similares a los anteriormente descriptos. 

### {.tabset .tabset-fade .tabset-pills}

#### **Gráfico (% aprobación)**
```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Descargar data desde opuy y crear tabla
dat_equipos <- opuy %>%
  filter(medicion == 'Evaluacion de gestion presidente',
         empresa == "Equipos") %>%
  select(fecha, anio_gobierno, empresa, valor, presidente, categoria_unificada)  %>%
  mutate(categoria_unificada = case_when(
    categoria_unificada == 3 ~ "Aprueba",  
    categoria_unificada == 2 ~ "Ni aprueba ni desaprueba",
    categoria_unificada == 1 ~ "Desaprueba",
    categoria_unificada == 0 ~ "NSNC")) %>%
  pivot_wider(names_from = categoria_unificada, values_from = valor) %>% 
  mutate(Saldo = Aprueba - Desaprueba) %>% 
  mutate(trimestre = lubridate::floor_date(fecha, "3 months" )) %>%
  mutate(trimestre = zoo::as.yearqtr(trimestre, format = "%Y-%m-%d")) %>% 
  mutate(quarter = zoo::as.yearqtr(format(trimestre), "%Y Q%q")) %>% 
  mutate(presidente = factor(presidente, 
                             levels = c("Lacalle", "Sanguinetti 2", "Batlle",
                                        "Vazquez 1", "Mujica", "Vazquez 2",
                                        "Lacalle Pou"))) %>% 
  group_by(quarter) %>% 
  summarize(Aprueba = mean(Aprueba),
            Saldo = mean(Saldo),
            presidente = first(presidente)) %>% 
    relocate(presidente, .after = quarter)

# Anotaciones para gráfico
annotation <- data.frame(
  x = fechas <- c(1992.25, 1997.25, 2002.25, 2007.25, 2012.25, 2017.25, 2022.25),
  y = 85,
  label = c("Lacalle","Sanguinetti II", "Batlle", "Vázquez I", "Mujica",
            "Vázquez II", "Lacalle Pou"))

fechas <- c(1994.85, 1999.85, 2004.85, 2009.85, 2014.85, 2019.85)

# Grafico % aprobación
aprob_serie_e <- dat_equipos %>%
  ggplot(aes(x = quarter, y = Aprueba, color = Aprueba)) +
  geom_line(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  geom_vline(xintercept = fechas,
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "% de aprobación",
       x = "",
       title = "Serie trimestral de aprobación del presidente",
       subtitle = "Promedio a partir de datos de Equipos",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy') +
  scale_colour_gradient2(low = "firebrick2", mid = "gold2" , high = "forestgreen", 
                         midpoint = mean(dat_equipos$Aprueba)) 

plot(aprob_serie_e)

```

```{r}
download_this(aprob_serie_e,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```

#### **Gráfico (saldo neto)**

```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Grafico saldo neto
aprob_serie_s_e <- dat_equipos %>%
  ggplot(aes(x = quarter, y = Saldo, color = Saldo)) +
  geom_line(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = fechas,
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_hline(yintercept = 0, size = 0.3) +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  annotate("segment", x = 1990.00, y = 15, xend = 1990.00, yend = 30,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n positivas",
           x = 1992.05, 
           y = 20,
           size = 3) +
  annotate("segment", x = 1990.00, y = -15, xend = 1990.00, yend = -30,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n negativas",
           x = 1992.05, 
           y = -20,
           size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "Saldo neto",
       x = "",
       title = "Serie trimestral de evaluación del presidente",
       subtitle = "Promedio de saldo neto a partir de datos de Equipos",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy') +
  scale_colour_gradient2(low = "firebrick2", mid = "gold2" , high = "forestgreen", 
                         midpoint = mean(dat_equipos$Saldo)) 

plot(aprob_serie_s_e)
```

```{r}
download_this(aprob_serie_s_e,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```

#### **Tabla**

```{r}
DT::datatable(dat_equipos %>%  
                arrange(desc(quarter)),
              extensions =  'Buttons',
              options =  list(dom = 'Bfrtip',
                              buttons = c('copy', 'csv', 'excel', 'print')))
```

#### **Código en R**

```{r, echo=TRUE, eval=FALSE}
## Instalar en caso de ser necesario
# install.packages("tidyverse")
# remotes::install_github("Nicolas-Schmidt/opuy")

library(opuy)
library(tidyverse)

# Descargar data desde opuy y crear tabla
dat_equipos <- opuy %>%
  filter(medicion == 'Evaluacion de gestion presidente',
         empresa == "Equipos") %>%
  select(fecha, anio_gobierno, empresa, valor, presidente, categoria_unificada)  %>%
  mutate(categoria_unificada = case_when(
    categoria_unificada == 3 ~ "Aprueba",  
    categoria_unificada == 2 ~ "Ni aprueba ni desaprueba",
    categoria_unificada == 1 ~ "Desaprueba",
    categoria_unificada == 0 ~ "NSNC")) %>%
  pivot_wider(names_from = categoria_unificada, values_from = valor) %>% 
  mutate(Saldo = Aprueba - Desaprueba) %>% 
  mutate(trimestre = lubridate::floor_date(fecha, "3 months" )) %>%
  mutate(trimestre = zoo::as.yearqtr(trimestre, format = "%Y-%m-%d")) %>% 
  mutate(quarter = zoo::as.yearqtr(format(trimestre), "%Y Q%q")) %>% 
  mutate(presidente = factor(presidente, 
                             levels = c("Lacalle", "Sanguinetti 2", "Batlle",
                                        "Vazquez 1", "Mujica", "Vazquez 2",
                                        "Lacalle Pou"))) %>% 
  group_by(quarter) %>% 
  summarize(Aprueba = mean(Aprueba),
            Saldo = mean(Saldo),
            presidente = first(presidente))

# Anotaciones para gráfico
annotation <- data.frame(
  x = fechas <- c(1992.25, 1997.25, 2002.25, 2007.25, 2012.25, 2017.25, 2022.25),
  y = 85,
  label = c("Lacalle","Sanguinetti II", "Batlle", "Vázquez I", "Mujica",
            "Vázquez II", "Lacalle Pou"))

fechas <- c(1994.85, 1999.85, 2004.85, 2009.85, 2014.85, 2019.85)

# Grafico % aprobación
aprob_serie_e <- dat_equipos %>%
  ggplot(aes(x = quarter, y = Aprueba, color = Aprueba)) +
  geom_line(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  geom_vline(xintercept = fechas,
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "% de aprobación",
       x = "",
       title = "Serie trimestral de aprobación del presidente",
       subtitle = "Promedio a partir de datos de Equipos",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy') +
  scale_colour_gradient2(low = "firebrick2", mid = "gold2" , high = "forestgreen", 
                         midpoint = mean(dat_equipos$Aprueba)) 

plot(aprob_serie_e)

# Grafico saldo neto
aprob_serie_s_e <- dat_equipos %>%
  ggplot(aes(x = quarter, y = Saldo, color = Saldo)) +
  geom_line(size = 1) +
  geom_point(size = 2, alpha = 0.6) +
  geom_hline(yintercept = 0) +
  geom_vline(xintercept = fechas,
             linetype = "dashed", size = 0.3, color = "grey30") +
  geom_hline(yintercept = 0, size = 0.3) +
  geom_text(data = annotation, aes(x = x, y = y, label = label),
            color = "black", size = 3) +
  annotate("segment", x = 1990.00, y = 15, xend = 1990.00, yend = 30,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n positivas",
           x = 1992.05, 
           y = 20,
           size = 3) +
  annotate("segment", x = 1990.00, y = -15, xend = 1990.00, yend = -30,
           arrow = arrow(type = "closed", length = unit(0.01, "npc"))) +
  annotate("text",
           label = "Evaluaciones \n negativas",
           x = 1992.05, 
           y = -20,
           size = 3) +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  labs(y = "Saldo neto",
       x = "",
       title = "Serie trimestral de evaluación del presidente",
       subtitle = "Promedio de saldo neto a partir de datos de Equipos",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy') +
  scale_colour_gradient2(low = "firebrick2", mid = "gold2" , high = "forestgreen", 
                         midpoint = mean(dat_equipos$Saldo)) 

plot(aprob_serie_s_e)
```

## {.toc-ignore .unlisted .unnumbered}

Los gráficos debajon presentan las medias por gobierno con barras de error que representan el desvío estandar. 

### {.tabset .tabset-fade .tabset-pills}

#### **Gráfico (% aprobación)**
```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Tabla final
dat_equipos_avg <- dat_equipos %>% 
  filter(presidente != "Lacalle Pou") %>% # Solo mandatos terminados
  group_by(presidente) %>% 
  summarize(aprob_m = round(mean(Aprueba), digits = 1),
            aprob_sd = round(sd(Saldo), digits = 1),
            saldo_m = round(mean(Saldo), digits = 1),
            saldo_sd = round(sd(Saldo), digits = 1)) 

# % Aprobacion
plot_promedio <- ggplot(data = dat_equipos_avg,
                        aes(x = presidente, y = aprob_m, color = presidente)) +
  geom_errorbar(aes(ymin = aprob_m - aprob_sd, ymax = aprob_m + aprob_sd), width=.1) +
  geom_point(size=3) +
  geom_text(aes(label = aprob_m),hjust = -.5, vjust = .5) +
  labs(title = "Promedio y desvío estandar de aprobación del presidente según administración",
       subtitle = "Cálculos sobre datos de Equipos Consultores (% de aprobación)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy',
       y = "", x = "") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) 

plot(plot_promedio)
```

```{r}
download_this(plot_promedio,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Gráfico (saldo neto)**
```{r, echo=FALSE, fig.width=10, fig.height=5, fig.align="center"}
# Saldo neto
plot_promedio_s <- ggplot(data = dat_equipos_avg,
                        aes(x = presidente, y = saldo_m, color = presidente)) +
  geom_errorbar(aes(ymin = saldo_m - saldo_sd, ymax = saldo_m + saldo_sd), width=.1) +
  geom_point(size=3) +
  geom_hline(yintercept = 0, size = .3, linetype = "dashed") +
  geom_text(aes(label = saldo_m),hjust = -.5, vjust = .5) +
  labs(title = "Promedio y desvío estandar de evaluación del presidente según administración",
       subtitle = "Cálculos sobre datos de Equipos Consultores (saldo neto)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy',
       y = "", x = "") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) 

plot(plot_promedio_s)
```

```{r}
download_this(plot_promedio_s,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Tabla**

```{r}
DT::datatable(dat_equipos_avg %>% 
                rename(Aprobación_Media = aprob_m,
                       Aprobación_Desvío = aprob_sd,
                       Saldo_Media = saldo_m,
                       Saldo_Desvío = saldo_sd,
                       Presidente = presidente),
              extensions =  'Buttons',
              options =  list(dom = 'Bfrtip',
                              buttons = c('copy', 'csv', 'excel', 'print')))
```


#### **Código en R**

```{r, echo=TRUE, eval=FALSE}
## Instalar en caso de ser necesario
# install.packages("tidyverse")
# install.packages("zoo")
# remotes::install_github("Nicolas-Schmidt/opuy")

library(opuy)
library(tidyverse)

# Descargar data desde opuy y crear tabla
dat_equipos <- opuy %>%
  filter(medicion == 'Evaluacion de gestion presidente',
         empresa == "Equipos") %>%
  select(fecha, anio_gobierno, empresa, valor, presidente, categoria_unificada)  %>%
  mutate(categoria_unificada = case_when(
    categoria_unificada == 3 ~ "Aprueba",  
    categoria_unificada == 2 ~ "Ni aprueba ni desaprueba",
    categoria_unificada == 1 ~ "Desaprueba",
    categoria_unificada == 0 ~ "NSNC")) %>%
  pivot_wider(names_from = categoria_unificada, values_from = valor) %>% 
  mutate(Saldo = Aprueba - Desaprueba) %>% 
  mutate(trimestre = lubridate::floor_date(fecha, "3 months" )) %>%
  mutate(trimestre = zoo::as.yearqtr(trimestre, format = "%Y-%m-%d")) %>% 
  mutate(quarter = zoo::as.yearqtr(format(trimestre), "%Y Q%q")) %>% 
  mutate(presidente = factor(presidente, 
                             levels = c("Lacalle", "Sanguinetti 2", "Batlle",
                                        "Vazquez 1", "Mujica", "Vazquez 2",
                                        "Lacalle Pou"))) %>% 
  group_by(quarter) %>% 
  summarize(Aprueba = mean(Aprueba),
            Saldo = mean(Saldo),
            presidente = first(presidente)) %>% 
  relocate(presidente, .after = quarter)

# Tabla final
dat_equipos_avg <- dat_equipos %>% 
  filter(presidente != "Lacalle Pou") %>% # Solo mandatos terminados
  group_by(presidente) %>% 
  summarize(aprob_m = round(mean(Aprueba), digits = 1),
            aprob_sd = round(sd(Saldo), digits = 1),
            saldo_m = round(mean(Saldo), digits = 1),
            saldo_sd = round(sd(Saldo), digits = 1)) 

# % Aprobacion
plot_promedio <- ggplot(data = dat_equipos_avg,
                        aes(x = presidente, y = aprob_m, color = presidente)) +
  geom_errorbar(aes(ymin = aprob_m - aprob_sd, ymax = aprob_m + aprob_sd), width=.1) +
  geom_point(size=3) +
  geom_text(aes(label = aprob_m),hjust = -.5, vjust = .5) +
  labs(title = "Promedio y desvío estandar de aprobación del presidente según administración",
       subtitle = "Cálculos sobre datos de Equipos Consultores (% de aprobación)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy',
       y = "", x = "") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) 

plot(plot_promedio)

# Saldo neto
plot_promedio_s <- ggplot(data = dat_equipos_avg,
                        aes(x = presidente, y = saldo_m, color = presidente)) +
  geom_errorbar(aes(ymin = saldo_m - saldo_sd, ymax = saldo_m + saldo_sd), width=.1) +
  geom_point(size=3) +
  geom_text(aes(label = saldo_m),hjust = -.5, vjust = .5) +
  geom_hline(yintercept = 0, size = .3, linetype = "dashed") +
  labs(title = "Promedio y desvío estandar de evaluación del presidente según administración",
       subtitle = "Cálculos sobre datos de Equipos Consultores (saldo neto)",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de opuy',
       y = "", x = "") +
  theme_minimal(base_size = 10) +
  theme(legend.position = "none") +
  scale_color_manual(name = "",
                     values = c("#5DADE2", "#BA0200", "#BA0200", "#013197",
                                "#013197", "#013197", "#5DADE2")) 

plot(plot_promedio_s)

```








## {.toc-ignore .unlisted .unnumbered}

## **Perspectiva comparada**

```{r , echo=FALSE, out.width= "55%", out.extra='style="float:right; padding:5px"'}
include_graphics("data/aprob_comparada.png")
```

<div style="text-align: justify">
Para poder comparar los niveles de aprobación presidencial entre países es necesario partir de estimaciones comparables y tener en cuenta los ciclos en la aprobación, es decir, comparar ciclos completos, o ciclos a la misma altura. En este caso para visualizar los promedios de aprobación de distintos presidentes en los países de América del Sur, utilizamos las series estimadas con el algoritmo de *dyad-ratios* publicadas por el [Executive Approval Project](http://www.executiveapproval.org/). Utilizando estas series trimestrales de aprobación en cada país calculamos el promedio para cada presidente que haya terminado su ciclo.

El gráfico muestra que el rango de aprobación es similar para la mayoría de los países. Tanto Argentina, Brasil, Chile, Colombia, Ecuador y Uruguay muestran un rango de entre poco menos de 40% y 60% de aprobación promedio de los presidentes con ciclos cumplidos. Por otra parte, Paraguay y Venezuela muestrna un valor máximo inferior, cercano al 45% mientras que Perú es el país que presenta los dos pormedios de aprobación más bajos para gobiernos que cumplieron el ciclo. 

Es importante considerar que la aprobación presidencial condiciona la probabilidad de que el presidente termine su ciclo. De esta forma, al considerar solamente gobiernos que hayan terminado su ciclo, se excluyen algunos mandatos con menor aprobación promedio 
</div>

<hr style="border:1.5px solid #2c3e50"> </hr>

<br />

# **Intención de voto**

<!-- ## **Tabaré Vázquez II (2014-2019)** -->

<!-- Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras interdum est a lorem ultricies feugiat. Curabitur vitae magna molestie, lacinia risus quis, egestas quam. Mauris tempor nunc neque, faucibus scelerisque leo porttitor eu. Maecenas sit amet mi ut justo consequat malesuada. Phasellus id ligula quis purus mattis vulputate nec a metus. Nam tempus pharetra feugiat. Nunc vitae metus commodo ante molestie semper vitae vitae orci. Ut convallis mi ligula, at aliquet justo tristique eu. Etiam facilisis nulla et luctus dapibus. In vel sagittis nibh. Cras mattis vehicula quam, et lacinia est sodales at. Fusce vitae mauris sed ante tempus tincidunt in eu elit. Etiam ornare fermentum erat, in aliquet mauris efficitur in. Morbi id tincidunt nisl. Ut et pharetra ipsum. -->

<!-- <br /> -->

<!-- <br /> -->

<!-- <div style="text-align: center"> -->
<!-- #### **Nombre de Indicador I**  -->
<!-- </div> -->

<!-- ### {.tabset .tabset-fade .tabset-pills} -->

<!-- #### Gráfico -->

<!-- ```{r, echo=FALSE, fig.width=8, fig.height=4, fig.align="center"} -->
<!-- gapminder <- gapminder::gapminder %>%  -->
<!--   filter(country == "Uruguay") -->

<!-- g1 <- ggplot(gapminder, -->
<!--        aes(x = year, y = lifeExp)) + -->
<!--   geom_point(size = 3, colour = "#2c3e50") + -->
<!--   geom_line(size = 1, colour = "#2c3e50", alpha = .6) + -->
<!--   theme_minimal() + -->
<!--   labs(x = "", y = "", -->
<!--        title = "Esperanza de vida en Uruguay") -->

<!-- plot(g1) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- download_this(g1, -->
<!--               button_label = "Descargar gráfico", -->
<!--               icon = "fa fa-download") -->
<!-- ``` -->


<!-- #### Tabla -->

<!-- ```{r} -->
<!-- DT::datatable(gapminder, -->
<!--               extensions =  'Buttons', -->
<!--               options =  list(dom = 'Bfrtip', -->
<!--                               buttons = c('copy', 'csv', 'excel', 'print'))) -->
<!-- ``` -->

<!-- #### Código en R -->

<!-- ```{r, echo=TRUE, eval=FALSE} -->
<!-- gapminder <- gapminder::gapminder %>%  -->
<!--   filter(year == 2007) -->

<!-- hist(gapminder$lifeExp, -->
<!--      main = "Distribución de esperanza de vida en 2007", -->
<!--      col = "skyblue3", -->
<!--      border ="black", -->
<!--      density = 75) -->

<!-- ``` -->


<!-- ## {.toc-ignore .unlisted .unnumbered} -->

<!-- ## **José Mujica (2014-2019)** -->

<!-- Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras interdum est a lorem ultricies feugiat. Curabitur vitae magna molestie, lacinia risus quis, egestas quam. Mauris tempor nunc neque, faucibus scelerisque leo porttitor eu. Maecenas sit amet mi ut justo consequat malesuada. Phasellus id ligula quis purus mattis vulputate nec a metus. Nam tempus pharetra feugiat. Nunc vitae metus commodo ante molestie semper vitae vitae orci. Ut convallis mi ligula, at aliquet justo tristique eu. Etiam facilisis nulla et luctus dapibus. In vel sagittis nibh. Cras mattis vehicula quam, et lacinia est sodales at. Fusce vitae mauris sed ante tempus tincidunt in eu elit. Etiam ornare fermentum erat, in aliquet mauris efficitur in. Morbi id tincidunt nisl. Ut et pharetra ipsum. -->

<!-- <div style="text-align: center"> -->
<!-- #### **Nombre de Indicador II**  -->
<!-- </div> -->

<!-- ### {.tabset .tabset-fade .tabset-pills} -->

<!-- #### Gráfico -->

<!-- ```{r, echo=FALSE, fig.width=8, fig.height=4, fig.align="center"} -->
<!-- gapminder <- gapminder::gapminder %>%  -->
<!--   filter(country == "Uruguay") -->

<!-- g1 <- ggplot(gapminder, -->
<!--        aes(x = year, y = lifeExp)) + -->
<!--   geom_point(size = 3, colour = "#2c3e50") + -->
<!--   geom_line(size = 1, colour = "#2c3e50", alpha = .6) + -->
<!--   theme_minimal() + -->
<!--   labs(x = "", y = "", -->
<!--        title = "Esperanza de vida en Uruguay") -->

<!-- plot(g1) -->
<!-- ``` -->


<!-- <!-- Por si no usan Plotly (que ya tiene botón de descarga) --> -->

<!-- ```{r} -->
<!-- download_this(g1, -->
<!--               button_label = "Descargar gráfico", -->
<!--               icon = "fa fa-download") -->
<!-- ``` -->

<!-- #### Tabla -->

<!-- ```{r} -->
<!-- DT::datatable(gapminder, -->
<!--               extensions =  'Buttons', -->
<!--               options =  list(dom = 'Bfrtip', -->
<!--                               buttons = c('copy', 'csv', 'excel', 'print'))) -->
<!-- ``` -->

<!-- #### Código en R -->

<!-- ```{r, echo=TRUE, eval=FALSE} -->
<!-- gapminder <- gapminder::gapminder %>%  -->
<!--   filter(year == 2007) -->

<!-- hist(gapminder$lifeExp, -->
<!--      main = "Distribución de esperanza de vida en 2007", -->
<!--      col = "skyblue3", -->
<!--      border ="black", -->
<!--      density = 75) -->

<!-- ``` -->

<!-- ## {.toc-ignore .unlisted .unnumbered} -->

<hr style="border:1.5px solid #2c3e50"> </hr>

# **Autoidentificación ideológica**

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras interdum est a lorem ultricies feugiat. Curabitur vitae magna molestie, lacinia risus quis, egestas quam. Mauris tempor nunc neque, faucibus scelerisque leo porttitor eu. Maecenas sit amet mi ut justo consequat malesuada. Phasellus id ligula quis purus mattis vulputate nec a metus. Nam tempus pharetra feugiat. Nunc vitae metus commodo ante molestie semper vitae vitae orci. Ut convallis mi ligula, at aliquet justo tristique eu. Etiam facilisis nulla et luctus dapibus. In vel sagittis nibh. Cras mattis vehicula quam, et lacinia est sodales at. Fusce vitae mauris sed ante tempus tincidunt in eu elit. Etiam ornare fermentum erat, in aliquet mauris efficitur in. Morbi id tincidunt nisl. Ut et pharetra ipsum. 

<div class="boxed">
**Latinobarómetro pregunta por la autoidentificación ideoógica de la siguiente manera:** *En política se habla normalmente de "izquierda" y "derecha" En una escala dónde “00" es la “izquierda” y “10" la “derecha”, ¿Dónde se ubicaría Ud?*.  
</div>

### {.tabset .tabset-fade .tabset-pills}

#### **Gráfico**
```{r, echo = FALSE, fig.width = 6, fig.height = 8, fig.align = "center"}
# Cargar tabla con datos y cambiar formato a largo
autid <- readxl::read_excel("data/latino/autid.xlsx") %>% 
  pivot_longer(`0`:n, 
               names_to = "cat",
               values_to = "valor") %>% 
  mutate(valor = as.numeric(valor))

# Filtrar por Uruguay y preparar datos para gráfico
autid_uy <- autid %>% 
  filter(pais == "Uruguay") %>% 
  filter(cat != "Media",
         cat != "n",
         cat != "sd") %>% 
  mutate(valor = valor * 1000) %>% 
  select(-pais) %>% 
  filter(!is.na(valor))

# Expandir datos agregados a observaciones
expanded <- data.frame(autid = rep(autid_uy$cat, autid_uy$valor),
                       year = rep(autid_uy$year, autid_uy$valor)) %>% 
  mutate(Partido = case_when(
    year >= 1995 & year <= 2004 ~ "Partido Colorado",
    year >= 2005 & year <= 2019 ~ "Frente Amplio",
    year >= 2020  ~ "Partido Nacional",
  ))

# Distribución 
plot_autid <-  ggplot(expanded, 
       aes(x = as.numeric(autid), y = fct_rev(as.factor(year)), fill = Partido)) + 
  ggridges::geom_density_ridges(rel_min_height = 0.005, 
                                scale = 3,
                                alpha = .4,
                                color = "black",
                                linetype = 1, # Tipo de línea
                                lwd = 0.5,
                                quantile_lines = TRUE, 
                                quantile_fun = mean) +
  theme_minimal() +
  theme(legend.position = "none") +
  # stat_density_ridges(quantile_lines = TRUE, alpha = 0.75, quantiles = 2) +
  labs(title = "Distribución de autoidentificación ideológica por año",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de Latinobarómetro',
       x = "", y = "") +
  scale_fill_manual(values = c("#013197", "#BA0200",  "#5DADE2")) +
  scale_x_continuous(breaks = seq(0, 10, by = 2))

plot(plot_autid)
```

```{r}
download_this(plot_autid,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Tabla**

```{r}
DT::datatable(readxl::read_excel("data/latino/autid.xlsx") %>%
                filter(pais == "Uruguay") %>% 
                pivot_longer(`0`:sd,
                             names_to = "cat",
                             values_to = "valor") %>%
                mutate(valor = as.numeric(valor)) %>%
                pivot_wider(values_from = "valor",
                            names_from = "cat"),
              extensions =  'Buttons',
              options =  list(dom = 'Bfrtip',
                              buttons = c('copy', 'csv', 'excel', 'print')))
```


#### **Código en R**

```{r, echo=TRUE, eval=FALSE}
## Instalar en caso de ser necesario
# install.packages("tidyverse")
# install.packages("ggridges")

library(tidyverse)
library(ggridges)

# Cargar tabla con datos y cambiar formato a largo
autid <- readxl::read_excel("data/latino/autid.xlsx") %>% 
  pivot_longer(`0`:n, 
               names_to = "cat",
               values_to = "valor") %>% 
  mutate(valor = as.numeric(valor))

# Filtrar por Uruguay y preparar datos para gráfico
autid_uy <- autid %>% 
  filter(pais == "Uruguay") %>% 
  filter(cat != "Media",
         cat != "n",
         cat != "sd") %>% 
  mutate(valor = valor * 1000) %>% 
  select(-pais) %>% 
  filter(!is.na(valor))

# Expandir datos agregados a observaciones
expanded <- data.frame(autid = rep(autid_uy$cat, autid_uy$valor),
                       year = rep(autid_uy$year, autid_uy$valor)) %>% 
  mutate(Partido = case_when(
    year >= 1995 & year <= 2004 ~ "Partido Colorado",
    year >= 2005 & year <= 2019 ~ "Frente Amplio",
    year >= 2020  ~ "Partido Nacional",
  ))

# Distribución 
ggplot(expanded, 
       aes(x = as.numeric(autid), y = fct_rev(as.factor(year)), fill = Partido)) + 
  ggridges::geom_density_ridges(rel_min_height = 0.005, 
                                scale = 3,
                                alpha = .4,
                                color = "black",
                                linetype = 1, # Tipo de línea
                                lwd = 0.5,
                                quantile_lines = TRUE, 
                                quantile_fun = mean) +
  theme_minimal() +
  theme(legend.position = "none") +
  # stat_density_ridges(quantile_lines = TRUE, alpha = 0.75, quantiles = 2) +
  labs(title = "Distribución de autoidentificación ideológica por año",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de Latinobarómetro',
       x = "", y = "") +
  scale_fill_manual(values = c("#013197", "#BA0200",  "#5DADE2")) +
  scale_x_continuous(breaks = seq(0, 10, by = 2))

```

## {.toc-ignore .unlisted .unnumbered}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras interdum est a lorem ultricies feugiat. Curabitur vitae magna molestie, lacinia risus quis, egestas quam. Mauris tempor nunc neque, faucibus scelerisque leo porttitor eu. Maecenas sit amet mi ut justo consequat malesuada. Phasellus id ligula quis purus mattis vulputate nec a metus. Nam tempus pharetra feugiat. Nunc vitae metus commodo ante molestie semper vitae vitae orci. Ut convallis mi ligula, at aliquet justo tristique eu. Etiam facilisis nulla et luctus dapibus. In vel sagittis nibh. Cras mattis vehicula quam, et lacinia est sodales at. Fusce vitae mauris sed ante tempus tincidunt in eu elit. Etiam ornare fermentum erat, in aliquet mauris efficitur in. Morbi id tincidunt nisl. Ut et pharetra ipsum.

### {.tabset .tabset-fade .tabset-pills}

#### **Gráfico**
```{r, echo=FALSE, fig.width=6, fig.height= 8, fig.align="center"}
# Cargar tabla con datos y cambiar formato a largo
autid <- readxl::read_excel("data/latino/autid.xlsx") %>% 
  pivot_longer(`0`:n, 
               names_to = "cat",
               values_to = "valor") %>% 
  mutate(valor = as.numeric(valor)) 

# Comparación Uru vs la región
autid_la <- autid %>% 
  filter(pais %in% c("Total América Latina", "Uruguay")) 

autid_la_uy <- autid_la %>% 
  filter(cat != "Media",
         cat != "n",
         cat != "sd") %>% 
  mutate(valor = valor * 1000) %>% 
  filter(!is.na(valor))

# Expandir datos agregados a observaciones
df_expanded <- data.frame(autid = rep(autid_la_uy$cat, autid_la_uy$valor),
                       year = rep(autid_la_uy$year, autid_la_uy$valor),
                       pais = rep(autid_la_uy$pais, autid_la_uy$valor))

# Gráfico
plot_autid_c <- ggplot(df_expanded,
       aes(x = as.numeric(autid), y = fct_rev(as.factor(year)), fill = pais)) + 
  geom_density_ridges(alpha = .6) +
  scale_fill_manual(name = "",
                    values = c("gold2", 
                               "dodgerblue3")) +
  labs(title = "Distribución de autoidentificación ideológica por año",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de Latinobarómetro',
       x = "", y = "") +
  theme_minimal() +
  theme(legend.position = "bottom") +
    scale_x_continuous(breaks = seq(0, 10, by = 2)) 

plot(plot_autid_c)
```

```{r}
download_this(plot_autid_c,
              button_label = "Descargar gráfico",
              icon = "fa fa-download")
```


#### **Tabla**

```{r}
DT::datatable(readxl::read_excel("data/latino/autid.xlsx") %>%
                filter(pais %in% c("Uruguay", "Total América Latina")) %>% 
                pivot_longer(`0`:sd,
                             names_to = "cat",
                             values_to = "valor") %>%
                mutate(valor = as.numeric(valor)) %>%
                pivot_wider(values_from = "valor",
                            names_from = "cat"),
              extensions =  'Buttons',
              options =  list(dom = 'Bfrtip',
                              buttons = c('copy', 'csv', 'excel', 'print')))

```


#### **Código en R**

```{r, echo=TRUE, eval=FALSE}
## Instalar en caso de ser necesario
# install.packages("tidyverse")
# install.packages("ggridges")

library(tidyverse)
library(ggridges)

# Cargar tabla con datos y cambiar formato a largo
autid <- readxl::read_excel("data/latino/autid.xlsx") %>% 
  pivot_longer(`0`:n, 
               names_to = "cat",
               values_to = "valor") %>% 
  mutate(valor = as.numeric(valor)) 

# Comparación Uru vs la región
autid_la <- autid %>% 
  filter(pais %in% c("Total América Latina", "Uruguay")) 

autid_la_uy <- autid_la %>% 
  filter(cat != "Media",
         cat != "n",
         cat != "sd") %>% 
  mutate(valor = valor * 1000) %>% 
  filter(!is.na(valor))

# Expandir datos agregados a observaciones
df_expanded <- data.frame(autid = rep(autid_la_uy$cat, autid_la_uy$valor),
                       year = rep(autid_la_uy$year, autid_la_uy$valor),
                       pais = rep(autid_la_uy$pais, autid_la_uy$valor))

# Gráfico
ggplot(df_expanded,
       aes(x = as.numeric(autid), y = fct_rev(as.factor(year)), fill = pais)) + 
  geom_density_ridges(alpha = .6) +
  scale_fill_manual(name = "",
                    values = c("gold2", 
                               "dodgerblue3")) +
  labs(title = "Distribución de autoidentificación ideológica por año, Uruguay y Total América Latina",
       caption = 'Fuente: Unidad de Métodos y Acceso a Datos (FCS-UdelaR) en base a datos de Latinobarómetro',
       x = "", y = "") +
  theme_minimal() +
  theme(legend.position = "bottom") +
    scale_x_continuous(breaks = seq(0, 10, by = 2))

ggsave("data/latino/ideo_comp.png", height = 30, width = 20, units = "cm")
```

## {.toc-ignore .unlisted .unnumbered}
<br />

<hr style="border:1.5px solid #2c3e50"> </hr>

# **Actitudes hacia la democracia**

<br />

<hr style="border:1.5px solid #2c3e50"> </hr>

# **Principal problema del país**

<br />

<hr style="border:1.5px solid #2c3e50"> </hr>

# **Principal problema del país**

<br />

<hr style="border:1.5px solid #2c3e50"> </hr>

# **Citar este documento**

UMAD (2020) Opinión Pública en Uruguay. Disponible en [**enlace en línea**]().

<hr style="border:1.5px solid #2c3e50"> </hr>

# **Referencias bibliográficas**

<div style="text-align: justify">										
Apellido, Nombre (2010) Nombre de trabajo. Revista

Aguiar, C. A. (2000). La Historia y la historia: Opinión Pública y opinión pública en el Uruguay. Prisma, (15), 7-45.

Calvo, E. (2007). The responsive legislature: Public opinion and law making in a highly disciplined legislature. British Journal of Political Science, 37(2), 263-280.

Carlin, R. E., Love, G. J., & Martínez-Gallardo, C. (2015). Cushioning the fall: Scandals, economic conditions, and executive approval. Political Behavior, 37(1), 109-130.

Carlin, R. E., Hartlyn, J., Hellwig, T., Love, G. J., Martínez-Gallardo, C., & Singer, M. M. (2018). Public support for Latin American presidents: The cyclical model in comparative perspective. Research & Politics, 5(3), 2053168018787690.

Martinez-Gallardo, C. (2012). Out of the cabinet: what drives defections from the government in presidential systems?. Comparative Political Studies, 45(1), 62-90.

Pérez-Liñán, A. (2007). Presidential impeachment and the new political instability in Latin America. Cambridge University Press.

Stimson, J. A. (1976). Public support for American presidents: A cyclical model. Public Opinion Quarterly, 40(1), 1-21.

Stimson, J. A. (2018). The Dyad ratios algorithm for estimating latent public opinion: estimation, testing, and comparison to other approaches. Bulletin of Sociological Methodology/Bulletin de Méthodologie Sociologique, 137(1), 201-218.

Zuasnábar, Ignacio (2018). Treinta años de opinión pública en el Uruguay. Montevideo: Konrad Adenauer Stiftung.

&nbsp;
<hr />

<div style="text-align: center">										

**Autores:** Fulanito, Menganito

**Equipo de programación:** Fulanito, Menganito

**Contacto:** umad@cienciassociales.com.uy


<p style="text-align: center;font-size 22px;"> <a href="https://umad.cienciassociales.edu.uy/">Unidad de Métodos y Acceso a Datos</a></p>

<!-- Add icon library -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->

<!-- Add font awesome icons -->
<!-- <p style="text-align: center;"> -->
<!--     <a href="https://twitter.com/r_graph_gallery?lang=en" class="fa fa-twitter"></a> -->
<!--     <a href="https://www.linkedin.com/in/yan-holtz-2477534a/" class="fa fa-linkedin"></a> -->
<!--     <a href="https://github.com/holtzy/" class="fa fa-github"></a> -->
<!-- </p> -->

<center>
![](www/logo_umad.png){width=250px}
</center>


&nbsp;


